# program.py å‡çº§è¯´æ˜

## âœ¨ æ–°åŠŸèƒ½ï¼šæ”¯æŒæ–‡æœ¬+æµ®ç‚¹æ•°CSVæ ¼å¼

### ğŸ“‹ æ›´æ–°æ‘˜è¦

`program.py` å·²å‡çº§ä¸ºæ™ºèƒ½å¤šæ ¼å¼CSVåŠ è½½å™¨ï¼Œç°åœ¨æ”¯æŒï¼š

1. âœ… **äºŒè¿›åˆ¶å‘é‡æ ¼å¼** (åŸæœ‰åŠŸèƒ½)
2. âœ… **æ–‡æœ¬+æµ®ç‚¹æ•°æ ¼å¼** (æ–°å¢) â­
3. âœ… **æ··åˆæ ¼å¼** (æ–°å¢)

### ğŸ”§ ä¿®æ”¹çš„æ–¹æ³•

#### 1. `load_csv_data()` - ä¸»åŠ è½½æ–¹æ³•
```python
# ä¹‹å‰ï¼šåªæ”¯æŒçº¯æ•´æ•°
self.auxiliary_list = [[int(x) for x in row] for row in self.csv_data]

# ç°åœ¨ï¼šæ™ºèƒ½æ£€æµ‹å’Œè½¬æ¢
self.data_format = self.detect_format(self.csv_data)
if self.data_format == "text_float":
    self.process_text_float_format()
```

#### 2. `detect_format()` - æ–°å¢æ–¹æ³•
**ä½œç”¨**: è‡ªåŠ¨æ£€æµ‹CSVæ ¼å¼ç±»å‹

**é€»è¾‘**:
```
æ£€æŸ¥ç¬¬ä¸€åˆ—ç¬¬ä¸€ä¸ªå€¼
  â”œâ”€ æ˜¯æ•°å­—ä¸”å…¨æ˜¯0/1? â†’ "binary_vector"
  â”œâ”€ æ˜¯æ–‡æœ¬ä¸”ç¬¬äºŒåˆ—æ˜¯æµ®ç‚¹? â†’ "text_float"
  â””â”€ å…¶ä»– â†’ "mixed"
```

#### 3. `process_text_float_format()` - æ–°å¢æ–¹æ³•
**ä½œç”¨**: å°†POIåœ°ç†æ•°æ®è½¬æ¢ä¸ºå…±ç°æ¨¡å¼

**è½¬æ¢æµç¨‹**:
```python
è¾“å…¥: Restaurant,39.97,116.30
     Hospital,39.97,116.31
     Cinema,39.98,116.30

æ­¥éª¤1: æå–ç‰¹å¾ç±»å‹
  â†’ [Cinema, Hospital, Restaurant]

æ­¥éª¤2: è®¡ç®—æ¯ä¸ªç‚¹å‘¨å›´çš„å…±ç°ç‰¹å¾
  Restaurant(39.97,116.30):
    - è·ç¦»<0.01åº¦å†…æ‰¾åˆ°: Hospital, Cinema
    - ç”Ÿæˆå‘é‡: [1,1,1]

æ­¥éª¤3: å»é‡å¹¶è¿”å›
  â†’ [[1,1,1], [1,1,0], [1,0,1], ...]
```

**å…³é”®å‚æ•°**:
```python
distance_threshold = 0.01  # çº¦1å…¬é‡Œ
# 0.01åº¦ â‰ˆ 1.1å…¬é‡Œï¼ˆåœ¨åŒ—çº¬40åº¦å·¦å³ï¼‰
```

#### 4. `process_mixed_format()` - æ–°å¢æ–¹æ³•
**ä½œç”¨**: å¤„ç†æ··åˆç±»å‹æ•°æ®

**æ™ºèƒ½è§£æ**:
- å°è¯•è½¬int â†’ æˆåŠŸåˆ™ä¿ç•™æ•´æ•°
- å¤±è´¥åˆ™å°è¯•float â†’ æˆåŠŸåˆ™ä¿ç•™æµ®ç‚¹æ•°  
- éƒ½å¤±è´¥åˆ™è·³è¿‡ï¼ˆå­—ç¬¦ä¸²ï¼‰

#### 5. `display_data_samples()` - å¢å¼ºæ–¹æ³•
**æ”¹è¿›**: 
- æ”¯æŒåŠ¨æ€ç‰¹å¾åï¼ˆä»æ•°æ®ä¸­æå–ï¼‰
- å…¼å®¹åŸæœ‰é™æ€ç‰¹å¾å
- æ›´å¥½çš„é”™è¯¯å¤„ç†

```python
# åŠ¨æ€ç‰¹å¾åï¼ˆtext_floatæ ¼å¼ï¼‰
if hasattr(self, 'feature_names'):
    feature_names = self.feature_names  # [Cinema, Hospital, ...]

# é™æ€ç‰¹å¾åï¼ˆbinary_vectoræ ¼å¼ï¼‰
else:
    feature_names = ['University', 'Hospital', ...]
```

---

## ğŸ“Š ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: åŠ è½½äºŒè¿›åˆ¶å‘é‡ï¼ˆåŸæœ‰åŠŸèƒ½ï¼‰

**æ–‡ä»¶**: `prevalent patterns.csv`
```csv
1,1,1,0,1,0,1,0,1,0
0,1,0,0,1,1,1,0,0,1
```

**ç»“æœ**:
- æ ¼å¼æ£€æµ‹: `binary_vector`
- ç›´æ¥åŠ è½½ä¸ºæ•´æ•°åˆ—è¡¨
- ä½¿ç”¨é»˜è®¤ç‰¹å¾åæ˜¾ç¤º

### ç¤ºä¾‹2: åŠ è½½æ–‡æœ¬+æµ®ç‚¹æ•°ï¼ˆæ–°åŠŸèƒ½ï¼‰â­

**æ–‡ä»¶**: `Beijing_haidian.csv`
```csv
Restaurants,39.978658,116.307898
Cinema,39.979228,116.305721
Hospital,39.976179,116.307838
```

**ç»“æœ**:
- æ ¼å¼æ£€æµ‹: `text_float`
- æå–ç‰¹å¾: `[Cinema, Hospital, Restaurants, School, Station, Theater]`
- è®¡ç®—å…±ç°å…³ç³»
- ç”Ÿæˆæ¨¡å¼å‘é‡
- å¼¹å‡ºä¿¡æ¯å¯¹è¯æ¡†:
  ```
  Converted text+float format to binary vectors
  Features: 6
  Patterns generated: 12
  Feature types: Cinema, Hospital, Restaurants, School, Station, Theater
  ```

### ç¤ºä¾‹3: ç”Ÿæˆçš„æ¨¡å¼ç¤ºä¾‹

**è¾“å…¥POIæ•°æ®**:
```
Restaurant @ (39.976, 116.308)
Hospital   @ (39.976, 116.308)  # è·ç¦»å¾ˆè¿‘
Cinema     @ (39.979, 116.306)  # è·ç¦»è¾ƒè¿œ
```

**ç”Ÿæˆçš„æ¨¡å¼**:
```
[0, 1, 1]  # Hospital + Restaurant (å…±ç°)
[1, 0, 0]  # Cinema (å•ç‹¬)
```

**å«ä¹‰**:
- æ¨¡å¼1: Hospitalå’ŒRestaurantç»å¸¸ä¸€èµ·å‡ºç°
- æ¨¡å¼2: Cinemaç‹¬ç«‹å‡ºç°

---

## ğŸ¯ æŠ€æœ¯ç»†èŠ‚

### è·ç¦»è®¡ç®—

```python
# æ¬§å‡ é‡Œå¾—è·ç¦»ï¼ˆç»çº¬åº¦ç©ºé—´ï¼‰
dist = sqrt((lat1-lat2)Â² + (lon1-lon2)Â²)

# é˜ˆå€¼
if dist <= 0.01:  # çº¦1å…¬é‡Œ
    è§†ä¸ºå…±ç°
```

### å»é‡æœºåˆ¶

```python
patterns_dict = {}  # å­—å…¸å»é‡
pattern_tuple = tuple(pattern)  # è½¬ä¸ºå…ƒç»„ä½œä¸ºkey
if pattern_tuple not in patterns_dict:
    patterns_dict[pattern_tuple] = pattern
```

### æœ€å°æ¨¡å¼é•¿åº¦

```python
if sum(pattern) >= 2:  # è‡³å°‘åŒ…å«2ä¸ªç‰¹å¾
    patterns_dict[pattern_tuple] = pattern
```

**åŸå› **: å•ç‰¹å¾æ¨¡å¼æ„ä¹‰ä¸å¤§ï¼Œå…±ä½æ¨¡å¼è‡³å°‘éœ€è¦2ä¸ªç‰¹å¾

---

## âš™ï¸ å‚æ•°è°ƒæ•´æŒ‡å—

### è°ƒæ•´è·ç¦»é˜ˆå€¼

åœ¨ `process_text_float_format()` ç¬¬899è¡Œ:

```python
# æ›´å®½æ¾ï¼ˆæ›´å¤šå…±ç°ï¼‰
distance_threshold = 0.02  # çº¦2å…¬é‡Œ

# æ›´ä¸¥æ ¼ï¼ˆæ›´å°‘å…±ç°ï¼‰
distance_threshold = 0.005  # çº¦500ç±³

# æ ¹æ®åŸå¸‚è§„æ¨¡è°ƒæ•´
# å¤§åŸå¸‚: 0.005 - 0.01
# å°åŸå¸‚: 0.01 - 0.03
```

### è°ƒæ•´æœ€å°æ¨¡å¼é•¿åº¦

åœ¨ç¬¬930è¡Œ:

```python
# å…è®¸å•ç‰¹å¾æ¨¡å¼
if pattern_tuple not in patterns_dict and sum(pattern) >= 1:

# è¦æ±‚æ›´å¤æ‚æ¨¡å¼
if pattern_tuple not in patterns_dict and sum(pattern) >= 3:
```

---

## ğŸ”„ å‘åå…¼å®¹æ€§

âœ… **å®Œå…¨å…¼å®¹**: åŸæœ‰çš„äºŒè¿›åˆ¶å‘é‡CSVä»ç„¶æ­£å¸¸å·¥ä½œ
âœ… **æ— éœ€ä¿®æ”¹**: ç”¨æˆ·ä»£ç æ— éœ€ä»»ä½•æ›´æ”¹
âœ… **è‡ªåŠ¨é€‚é…**: ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„å¤„ç†æ–¹å¼

---

## ğŸ› é”™è¯¯å¤„ç†

### æ–‡ä»¶æ ¼å¼é”™è¯¯
```python
try:
    # åŠ è½½å’Œè½¬æ¢
except Exception as e:
    QMessageBox.critical(self, "Error", f"Failed to load file: {str(e)}")
```

### ç©ºæ•°æ®å¤„ç†
```python
if not self.auxiliary_list:
    # ç”Ÿæˆå•ç‰¹å¾æ¨¡å¼ä½œä¸ºfallback
    for feat in feature_types:
        pattern = [1 if f == feat else 0 for f in feature_types]
        self.auxiliary_list.append(pattern)
```

---

## ğŸ“ˆ æ€§èƒ½å½±å“

### æ—¶é—´å¤æ‚åº¦

**äºŒè¿›åˆ¶å‘é‡**: O(n)
- n = è¡Œæ•°

**æ–‡æœ¬+æµ®ç‚¹æ•°**: O(nÂ²)
- éœ€è¦è®¡ç®—æ‰€æœ‰ç‚¹å¯¹ä¹‹é—´çš„è·ç¦»
- å¯¹äºn=1000: çº¦1,000,000æ¬¡è·ç¦»è®¡ç®—

**ä¼˜åŒ–å»ºè®®**:
- å¯¹äºå¤§æ•°æ®é›†(>10000ç‚¹)ï¼Œè€ƒè™‘ä½¿ç”¨KDæ ‘æˆ–ç©ºé—´ç´¢å¼•
- å½“å‰å®ç°é€‚åˆå°åˆ°ä¸­ç­‰æ•°æ®é›†(<5000ç‚¹)

### å†…å­˜å ç”¨

- äºŒè¿›åˆ¶å‘é‡: ~è¡Œæ•° Ã— åˆ—æ•° Ã— 4å­—èŠ‚
- æ–‡æœ¬+æµ®ç‚¹æ•°: é¢å¤–å­˜å‚¨åŸå§‹åæ ‡æ•°æ®

---

## ğŸ§ª æµ‹è¯•æ–‡ä»¶

å·²åˆ›å»ºæµ‹è¯•æ–‡ä»¶:

1. `test_text_float.csv` - æ–‡æœ¬+æµ®ç‚¹æ•°ç¤ºä¾‹
2. `README_FORMAT.md` - æ ¼å¼è¯´æ˜æ–‡æ¡£
3. `UPGRADE_NOTES.md` - æœ¬æ–‡æ¡£

**æµ‹è¯•æ­¥éª¤**:
```bash
1. è¿è¡Œ python program.py
2. ç‚¹å‡» "Open CSV File"
3. é€‰æ‹© test_text_float.csv
4. è§‚å¯Ÿä¿¡æ¯å¯¹è¯æ¡†
5. æŸ¥çœ‹ç”Ÿæˆçš„æ¨¡å¼
```

---

## ğŸ“ æ€»ç»“

### æ–°å¢åŠŸèƒ½
- âœ… è‡ªåŠ¨æ ¼å¼æ£€æµ‹
- âœ… æ–‡æœ¬+æµ®ç‚¹æ•°æ”¯æŒ
- âœ… POIå…±ç°æ¨¡å¼ç”Ÿæˆ
- âœ… åŠ¨æ€ç‰¹å¾åæå–
- âœ… æ··åˆæ ¼å¼å¤„ç†

### ä¿æŒä¸å˜
- âœ… åŸæœ‰APIä¸å˜
- âœ… ç”¨æˆ·ç•Œé¢ä¸å˜
- âœ… åç»­å¤„ç†æµç¨‹ä¸å˜

### æ”¹è¿›ç‚¹
- ğŸ¯ æ›´çµæ´»çš„æ•°æ®è¾“å…¥
- ğŸ¯ æ›´æ™ºèƒ½çš„æ ¼å¼è¯†åˆ«
- ğŸ¯ æ›´å¥½çš„ç”¨æˆ·åé¦ˆ
- ğŸ¯ æ›´å¼ºçš„æ‰©å±•æ€§

---

**å‡çº§å®Œæˆï¼ç°åœ¨å¯ä»¥ç›´æ¥ä½¿ç”¨ Beijing_haidian.csv ç­‰POIæ•°æ®äº†ï¼** ğŸ‰


