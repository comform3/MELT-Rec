# program.py 用户交互流程说明

## 📱 主界面结构

程序启动后显示一个 **1200×800** 的现代化窗口：

```
┌────────────────────────────────────────────────────────┐
│           Meta-PatternLearner (标题栏)                  │
│    Interactive Data Mining with Meta-Learning         │
├────────────────────────────────────────────────────────┤
│                                                        │
│  左侧面板 (600px)          │  右侧面板 (600px)         │
│  ─────────────────         │  ─────────────────        │
│  • Data Loading            │  • Model Monitor          │
│  • User Interaction        │  • Pattern Visualization  │
│  • Results                 │                           │
│                            │                           │
├────────────────────────────────────────────────────────┤
│  状态栏: Ready | 用户偏好统计 | [进度条]                │
└────────────────────────────────────────────────────────┘
```

---

## 🔄 完整交互流程（5步）

### **第1步：加载数据**

**界面位置**：左侧 → Tab 1 "Data Loading"

**操作**：
1. 点击 **"Open CSV File"** 按钮
2. 选择CSV文件（支持3种格式）：
   - 二进制向量：`1,0,1,0,1`
   - 文本+浮点数：`Restaurant,39.97,116.30` ⭐新功能
   - 混合格式

**系统响应**：
- 自动检测格式
- 如果是文本+浮点数，弹出对话框显示转换结果：
  ```
  ✓ 已转换为二进制向量
  特征数：6
  生成模式数：12
  ```
- 显示数据摘要：
  - 加载的模式数量
  - 特征类型列表
  - 前50个样本预览

---

### **第2步：启动交互**

**界面位置**：左侧 → Tab 2 "User Interaction"

**操作**：
1. （可选）调整"Pattern Diversity"滑块
   - 向左：更多简单模式
   - 向右：更多复杂模式
2. 点击 **"Start Interaction"** 按钮

**系统响应**：
- 根据多样性设置随机选择5-15个模式
- 弹出模式选择对话框

---

### **第3步：标注模式**

**界面**：弹出对话框 (500×600)

```
┌─────────────────────────────────────────────┐
│  Select Interesting Patterns                │
├─────────────────────────────────────────────┤
│  请选择您感兴趣的模式：                       │
│                                             │
│  [ ] Pattern 1: Hospital, School            │
│      ★★☆☆☆☆☆☆☆☆ (复杂度：2个特征)         │
│                                             │
│  [✓] Pattern 2: Restaurant, Cinema, Station │
│      ★★★☆☆☆☆☆☆☆ (复杂度：3个特征)         │
│                                             │
│  [✓] Pattern 3: University, Library, Museum │
│      ★★★☆☆☆☆☆☆☆ (复杂度：3个特征)         │
│                                             │
│  [ ] Pattern 4: Hospital, Pharmacy          │
│      ★★☆☆☆☆☆☆☆☆ (复杂度：2个特征)         │
│                                             │
│         [  OK  ]      [ Cancel ]            │
└─────────────────────────────────────────────┘
```

**操作**：
1. 勾选感兴趣的模式（可多选）
2. 点击 **OK** 确认

**说明**：
- 星星数量 = 模式复杂度（包含几个特征）
- 建议至少选择2-3个模式
- 按复杂度从低到高排序

---

### **第4步：模型微调**

**界面位置**：
- 左侧：显示状态 "Fine-tuning model..."
- 右侧 → Tab 1 "Model Monitor"：实时监控

**系统自动执行**：
1. 将您选中的模式标记为"感兴趣"（标签=1）
2. 未选中的模式标记为"不感兴趣"（标签=0）
3. 微调模型5轮

**界面显示**：
```
右侧 Model Monitor 面板：
─────────────────────────
Meta-Loss:      0.35  ↓ (红色，下降中)
Meta-Accuracy:  87.5% ↑ (蓝色，上升中)
Epoch:          3/5
Current Task:   14 samples

[实时更新的折线图]
```

**完成后**：
- 状态栏显示：`Fine-tuning complete! Test accuracy: 100%`
- 左侧状态栏更新用户偏好统计：`User preferences: Hospital(5), School(3), Cinema(2)`

---

### **第5步：查看预测结果**

**界面位置**：
- 左侧 → Tab 3 "Results"：文字列表
- 右侧 → Tab 2 "Pattern Visualization"：可视化图谱

**结果展示**：

#### 左侧：文字列表
```
Predicted interesting patterns:

Pattern 1: Hospital, School
Pattern 2: Restaurant, Cinema, Station
Pattern 3: University, Library
Pattern 4: Hospital, Pharmacy
Pattern 5: Cinema, Theater
Pattern 6: School, Library
Pattern 7: Restaurant, Hotel
Pattern 8: Station, Hospital

Total: 8 patterns
```

#### 右侧：关系图谱
```
        P1 ●────● P3
        │      ╱
        │    ╱
       P5●─● P4
        │
       P2●

节点 = 模式
边 = 相似度 (>0.75才显示)
节点大小 = 复杂度
```

**操作**：
- 鼠标悬停在节点上：显示模式详情
- 点击 "Refresh Visualization"：刷新图谱

---

## 🔄 持续学习

完成一轮交互后，您可以：

1. **继续标注**：
   - 再次点击 "Start Interaction"
   - 标注新的模式样本
   - 系统会累积您的偏好

2. **查看历史**：
   - 用户偏好统计会实时更新
   - 状态栏显示最常选择的特征

3. **效果提升**：
   - 标注越多，预测越准确
   - 建议至少进行3-5轮交互

---

## 🎯 关键界面元素说明

### 左侧面板

**Tab 1: Data Loading**
- 作用：加载和查看数据
- 关键按钮：`Open CSV File`

**Tab 2: User Interaction**
- 作用：配置和启动交互
- 关键控件：
  - 滑块：控制模式多样性
  - 按钮：`Start Interaction`

**Tab 3: Results**
- 作用：查看预测结果
- 内容：预测的感兴趣模式列表

### 右侧面板

**Tab 1: Model Monitor**
- 作用：实时监控训练过程
- 显示：Loss、Accuracy、Epoch、折线图

**Tab 2: Pattern Visualization**
- 作用：可视化模式关系
- 显示：网络图（节点=模式，边=相似度）
- 交互：悬停查看详情，点击刷新

### 状态栏

- 左侧：当前操作状态
- 中间：用户偏好摘要（Top 3特征）
- 右侧：进度条

---

## 💡 使用技巧

### 首次使用
1. 加载数据
2. 等待后台元学习预训练完成（自动）
3. 开始第一轮交互

### 标注建议
- ✅ 选择真正感兴趣的模式
- ✅ 混合不同复杂度的模式
- ✅ 每轮至少选2-3个
- ❌ 不要全选或全不选

### 多样性设置
- **低**（0-2）：主要展示简单模式（2-3个特征）
- **中**（2-3）：混合模式
- **高**（4-5）：更多复杂模式（4-5个特征）

### 持续学习
- 多轮交互效果更好
- 系统会记住您的偏好
- 预测会越来越符合您的兴趣

---

## 🔄 完整示例流程

```
1. 启动程序
   ↓
2. 点击 "Open CSV File" → 选择 Beijing_haidian.csv
   ↓
3. 看到弹窗："已转换为二进制向量，特征数：6"
   ↓
4. 等待2-3秒（后台预训练，自动完成）
   ↓
5. 点击 "Start Interaction"
   ↓
6. 弹出对话框，显示7个模式
   ↓
7. 勾选3个感兴趣的模式，点击OK
   ↓
8. 右侧显示训练进度（约2-3秒）
   ↓
9. 左侧Tab3显示预测结果：8个模式
   ↓
10. 右侧Tab2显示可视化图谱
   ↓
11. （可选）再次点击 "Start Interaction" 继续
```

---

## ❓ 常见问题

**Q1：点击 "Start Interaction" 提示 "No Data"？**
- A：需要先加载CSV文件

**Q2：对话框没有弹出？**
- A：等待元学习预训练完成（状态栏会显示）

**Q3：预测结果很少？**
- A：多标注几轮，系统需要学习您的偏好

**Q4：图谱显示 "Waiting for data..."？**
- A：需要先完成一轮交互和预测

**Q5：如何加载POI数据？**
- A：直接加载文本+浮点数格式CSV，系统自动转换

---

**总结**：program.py 提供了一个友好的图形界面，让您通过简单的点击和勾选，就能训练一个基于元学习的模式推荐系统！整个过程分为5步：加载数据 → 启动交互 → 标注模式 → 模型微调 → 查看结果。🎉


